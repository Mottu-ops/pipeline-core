name: Database Migration

on:
  workflow_call:
    inputs:
      PROJECT_FILE_PATH:
        required: true
        type: string  
jobs:
  build:
    name: nuget build & package
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup NuGet.exe for use with actions
        uses: NuGet/setup-nuget@v1.0.7
        with:
          nuget-version: 6.3.0

      - name: Setup .NET Core SDK 6.x
        uses: actions/setup-dotnet@v2.1.0
        with:
          dotnet-version: 6.x
          source-url: https://pkgs.dev.azure.com/mottu-ops/_packaging/mottu-ops/nuget/v3/index.json
        env:
          NUGET_AUTH_TOKEN: ${{ secrets.AZURE_ARTIFACTS_PAT }} 


      - run: dotnet restore ${{ inputs.PROJECT_FILE_PATH }}


      - name: Build DotNet
        # You may pin to the exact commit or the version.
        # uses: Elskom/build-dotnet@54d97a0f7d5d5ca946404976db00d27386b09254
        uses: Elskom/build-dotnet@v1.1.1
        with:
          # Filepath of the solution of which contains all the projects to be built, optionally tested and packed, relative to root of repository
          SOLUTION_FILE_PATH: ${{ inputs.PROJECT_FILE_PATH }}
          PACK: true


      # - run: |
      #     dotnet build ${{ inputs.PROJECT_FILE_PATH }}
      #     dotnet pack  ${{ inputs.PROJECT_FILE_PATH }} --version-suffix $GITHUB_RUN_ID

      - run: |
          ls bin/Release/ || true

      # # Publish the package to Azure Artifacts
      # - name: 'dotnet publish'
      #   run: dotnet nuget push --api-key AzureArtifacts bin/Release/*.nupkg 
  
